<Window x:Class="UnfuckMyTime.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="UnfuckMyTime" Height="650" Width="900"
        Background="Transparent" Foreground="#E0E0E0"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None" AllowsTransparency="True" ResizeMode="CanResize"
        Closing="Window_Closing" Loaded="Window_Loaded">

    <Window.Resources>
        <!-- Modern Button Style -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="#3A3A3A"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#505050"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Primary Action Button Style -->
        <Style x:Key="PrimaryButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                        <GradientStop Color="#6C5CE7" Offset="0"/>
                        <GradientStop Color="#a29bfe" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                             <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                         <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="0.9"/>
                            </Trigger>
                              <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Window Control Button Style -->
        <Style x:Key="WindowControlButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#AAA"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Width" Value="30"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#333"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="CloseButton" TargetType="Button" BasedOn="{StaticResource WindowControlButton}">
             <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="0,8,0,0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#D63031"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

         <!-- Input TextBox Style -->
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="#1E1E1E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#333"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="CaretBrush" Value="White"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                         <Border x:Name="border" Background="{TemplateBinding Background}" 
                                 BorderBrush="{TemplateBinding BorderBrush}" 
                                 BorderThickness="{TemplateBinding BorderThickness}" 
                                 CornerRadius="4">
                            <ScrollViewer x:Name="PART_ContentHost"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="#6C5CE7"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- PasswordBox Style -->
         <Style TargetType="PasswordBox">
            <Setter Property="Background" Value="#1E1E1E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#333"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="CaretBrush" Value="White"/>
             <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="PasswordBox">
                         <Border x:Name="border" Background="{TemplateBinding Background}" 
                                 BorderBrush="{TemplateBinding BorderBrush}" 
                                 BorderThickness="1" 
                                 CornerRadius="4">
                            <ScrollViewer x:Name="PART_ContentHost"/>
                        </Border>
                         <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="#6C5CE7"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </Window.Resources>

    <!-- Main Window Border/Container -->
    <Border Background="#121212" CornerRadius="8" BorderBrush="#333" BorderThickness="1">
        <Border.Effect>
            <DropShadowEffect BlurRadius="15" ShadowDepth="2" Opacity="0.4" Color="Black"/>
        </Border.Effect>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="32"/> <!-- Title Bar -->
                <RowDefinition Height="*"/>  <!-- Content -->
                <RowDefinition Height="26"/> <!-- Status Bar -->
            </Grid.RowDefinitions>

            <!-- Title Bar -->
            <Grid Grid.Row="0" Background="Transparent" MouseDown="Window_MouseDown">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Icon/Title -->
                <StackPanel Orientation="Horizontal" Margin="10,0,0,0" VerticalAlignment="Center">
                    <TextBlock Text="🎯" Foreground="#6C5CE7" Margin="0,0,8,0"/>
                    <TextBlock Text="UnfuckMyTime" Foreground="#CCC" FontSize="12" FontWeight="SemiBold"/>
                </StackPanel>

                <!-- Window Controls -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Content="⚙" Style="{StaticResource WindowControlButton}" Click="SettingsBtn_Click" ToolTip="Advanced Settings"/>
                    <Button Content="−" Style="{StaticResource WindowControlButton}" Click="MinimizeBtn_Click"/>
                    <Button Content="✕" Style="{StaticResource CloseButton}" Click="Window_Close_Click"/>
                </StackPanel>
            </Grid>

            <!-- Main Content Area -->
            <Grid Grid.Row="1" Margin="20,5,20,5">
                <!-- Setup View -->
                <Grid x:Name="SetupView" Visibility="Visible">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/> <!-- API Key (Moved slightly) -->
                        <RowDefinition Height="Auto"/> <!-- Prompt -->
                        <RowDefinition Height="Auto"/> <!-- Generate Button -->
                        <RowDefinition Height="*"/>    <!-- Plan Preview -->
                        <RowDefinition Height="Auto"/> <!-- Start Button -->
                    </Grid.RowDefinitions>

                    <!-- API Key (Right Aligned) -->
                    <Grid Grid.Row="0" Margin="0,0,0,10">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                             <TextBlock x:Name="ApiKeyLabel" Text="OpenAI Key" VerticalAlignment="Center" Foreground="#555" Margin="0,0,8,0" FontSize="10"/>
                            <PasswordBox x:Name="ApiKeyInput" Width="180" FontSize="10" Padding="3" Background="#0F0F0F" BorderBrush="#222"/>
                            <Button Content="?" Background="Transparent" Foreground="#555" BorderThickness="0" Margin="5,0,0,0" Cursor="Hand" Click="APIKeyHelp_Click"/>
                        </StackPanel>
                        <TextBlock Text="Reclaim your focus." FontSize="11" Foreground="#666" VerticalAlignment="Center" HorizontalAlignment="Left"/>
                    </Grid>

                    <!-- Prompt Section -->
                    <Grid Grid.Row="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="What is your goal?" FontSize="13" FontWeight="SemiBold" Margin="0,0,0,5" Foreground="#CCC"/>
                        <TextBox x:Name="PromptInput" Grid.Row="1" Height="60" 
                                 TextWrapping="Wrap" AcceptsReturn="True" 
                                 Text="Next 5 minutes: finish section 3 of the report. Only VS + docs + Jira allowed + chatgpt. max slack time 5s, reset time 10s" 
                                 TextChanged="PromptInput_TextChanged"
                                 VerticalScrollBarVisibility="Auto"/>
                    </Grid>

                    <Grid Grid.Row="2" Margin="0,10,0,0">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center">
                             <Button x:Name="LoadPlanBtn" Content="Load" Style="{StaticResource ModernButton}" Width="60" Margin="0,0,10,0" Click="LoadPlan_Click"/>
                             <Button x:Name="SavePlanBtn" Content="Save" Style="{StaticResource ModernButton}" Width="60" Click="SavePlan_Click"/>
                        </StackPanel>
                        
                        <Button x:Name="GenerateBtn" 
                                Content="Generate Plan" 
                                Style="{StaticResource PrimaryButton}"
                                HorizontalAlignment="Right"
                                Click="GenerateBtn_Click"/>
                    </Grid>

                    <!-- Plan Preview Section -->
                    <Grid Grid.Row="3" Margin="0,15,0,10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/> <!-- Header -->
                            <RowDefinition Height="Auto"/> <!-- Reasoning -->
                            <RowDefinition Height="Auto"/> <!-- Stats Chips -->
                            <RowDefinition Height="Auto"/> <!-- Main App Input -->
                            <RowDefinition Height="*"/>    <!-- Lists -->
                        </Grid.RowDefinitions>

                        <TextBlock Text="STRATEGY" Foreground="#555" FontSize="10" FontWeight="Bold" Margin="0,0,0,5"/>

                        <!-- Reasoning -->
                        <ScrollViewer Grid.Row="1" MaxHeight="50" Margin="0,0,0,10" VerticalScrollBarVisibility="Auto">
                            <TextBlock x:Name="PlanReasoning" Text="Plan details will appear here..." TextWrapping="Wrap" Foreground="#DDD" FontSize="12" />
                        </ScrollViewer>

                        <!-- Stats Row -->
                        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,15">
                            <!-- Duration Chip -->
                            <Border x:Name="DurationChip" Background="#252526" CornerRadius="4" Padding="8,4" Margin="0,0,8,0" Cursor="Hand" MouseLeftButtonUp="DurationChip_Click">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="⏱" Foreground="#A29BFE" Margin="0,0,6,0" FontSize="12"/>
                                    <TextBlock x:Name="PlanDuration" Text="-- m" Foreground="White" FontWeight="SemiBold" FontSize="12"/>
                                </StackPanel>
                            </Border>
                            <Popup x:Name="DurationPopup" PlacementTarget="{Binding ElementName=DurationChip}" StaysOpen="False" AllowsTransparency="True">
                                 <Border Background="#333" BorderBrush="#555" BorderThickness="1" CornerRadius="6" Padding="15" Width="200" Margin="5">
                                     <Border.Effect>
                                         <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.5"/>
                                     </Border.Effect>
                                     <StackPanel>
                                         <TextBlock Text="Duration (min)" Foreground="#AAA" FontSize="10" FontWeight="Bold" Margin="0,0,0,8"/>
                                         <Slider x:Name="DurationSlider" Minimum="0" Maximum="4" TickFrequency="1" IsSnapToTickEnabled="True" ValueChanged="DurationSlider_ValueChanged"/>
                                         <TextBlock x:Name="DurationSliderValue" Text="30m" Foreground="White" HorizontalAlignment="Center" Margin="0,5,0,0" FontSize="11"/>
                                     </StackPanel>
                                 </Border>
                            </Popup>

                            <!-- Slack Chip -->
                            <Border x:Name="SlackChip" Background="#252526" CornerRadius="4" Padding="8,4" Margin="0,0,8,0" Cursor="Hand" MouseLeftButtonUp="SlackChip_Click">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="🛡" Foreground="#FF7675" Margin="0,0,6,0" FontSize="12"/>
                                    <TextBlock x:Name="PlanSlack" Text="Slack: --" Foreground="White" FontWeight="SemiBold" FontSize="12"/>
                                </StackPanel>
                            </Border>
                            <Popup x:Name="SlackPopup" PlacementTarget="{Binding ElementName=SlackChip}" StaysOpen="False" AllowsTransparency="True">
                                 <Border Background="#333" BorderBrush="#555" BorderThickness="1" CornerRadius="6" Padding="15" Width="200" Margin="5">
                                     <Border.Effect>
                                         <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.5"/>
                                     </Border.Effect>
                                     <StackPanel>
                                         <TextBlock Text="Slack Budget" Foreground="#AAA" FontSize="10" FontWeight="Bold" Margin="0,0,0,8"/>
                                         <Slider x:Name="SlackSlider" Minimum="0" Maximum="7" TickFrequency="1" IsSnapToTickEnabled="True" ValueChanged="SlackSlider_ValueChanged"/>
                                         <TextBlock x:Name="SlackSliderValue" Text="1m" Foreground="White" HorizontalAlignment="Center" Margin="0,5,0,0" FontSize="11"/>
                                     </StackPanel>
                                 </Border>
                            </Popup>
                            
                            <!-- Reset Chip -->
                            <Border x:Name="ResetChip" Background="#252526" CornerRadius="4" Padding="8,4" Cursor="Hand" MouseLeftButtonUp="ResetChip_Click">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="🔄" Foreground="#74B9FF" Margin="0,0,6,0" FontSize="12"/>
                                    <TextBlock x:Name="PlanReset" Text="Reset: --" Foreground="White" FontWeight="SemiBold" FontSize="12"/>
                                </StackPanel>
                            </Border>
                            <Popup x:Name="ResetPopup" PlacementTarget="{Binding ElementName=ResetChip}" StaysOpen="False" AllowsTransparency="True">
                                 <Border Background="#333" BorderBrush="#555" BorderThickness="1" CornerRadius="6" Padding="15" Width="200" Margin="5">
                                     <Border.Effect>
                                         <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.5"/>
                                     </Border.Effect>
                                     <StackPanel>
                                         <TextBlock Text="Reset Time" Foreground="#AAA" FontSize="10" FontWeight="Bold" Margin="0,0,0,8"/>
                                         <Slider x:Name="ResetSlider" Minimum="0" Maximum="7" TickFrequency="1" IsSnapToTickEnabled="True" ValueChanged="ResetSlider_ValueChanged"/>
                                         <TextBlock x:Name="ResetSliderValue" Text="5m" Foreground="White" HorizontalAlignment="Center" Margin="0,5,0,0" FontSize="11"/>
                                     </StackPanel>
                                 </Border>
                            </Popup>
                        </StackPanel>



                         <!-- Main App Input -->
                        <Grid Grid.Row="3" Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="MAIN FOCUS APP (PROCESS NAME)" VerticalAlignment="Center" Foreground="#888" FontSize="10" FontWeight="Bold" Margin="0,0,10,0"/>
                            <TextBox x:Name="PlanMainAppInput" Grid.Column="1" Background="#1A1A1A" BorderBrush="#333" FontSize="11" Height="24" Padding="5,2" VerticalContentAlignment="Center"/>
                        </Grid>

                        <!-- Lists -->
                        <Grid Grid.Row="4">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Apps -->
                            <Grid Grid.Column="0" Margin="0,0,5,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <TextBlock Text="ALLOWED APPS" Foreground="#888" FontSize="10" FontWeight="Bold" Margin="0,0,0,5"/>
                                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0,0,0,5" Background="#1A1A1A">
                                    <ItemsControl x:Name="AllowedAppsList">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="#2D3436" CornerRadius="3" Padding="6,3" Margin="2">
                                                    <DockPanel>
                                                        <Button DockPanel.Dock="Right" Content="✕" Click="RemoveApp_Click" 
                                                                Background="Transparent" BorderThickness="0" Foreground="#FF7675" 
                                                                Padding="5,0" Margin="4,0,-4,0" Cursor="Hand" VerticalAlignment="Center" FontSize="10">
                                                            <Button.Template>
                                                                <ControlTemplate TargetType="Button">
                                                                    <Border Background="Transparent">
                                                                        <ContentPresenter/>
                                                                    </Border>
                                                                </ControlTemplate>
                                                            </Button.Template>
                                                        </Button>
                                                        <TextBlock Text="{Binding}" Foreground="#CCC" FontSize="11" VerticalAlignment="Center"/>
                                                    </DockPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                                <DockPanel Grid.Row="2">
                                    <Button Content="+" Width="24" DockPanel.Dock="Right" Style="{StaticResource ModernButton}" Padding="0" Click="AddApp_Click"/>
                                    <TextBox x:Name="NewAppInput" Margin="0,0,3,0" KeyDown="NewAppInput_KeyDown" VerticalContentAlignment="Center" Height="24" Padding="4,0" FontSize="11"/>
                                </DockPanel>
                            </Grid>

                            <!-- Sites -->
                            <Grid Grid.Column="1" Margin="5,0,5,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <TextBlock Text="ALLOWED SITES" Foreground="#888" FontSize="10" FontWeight="Bold" Margin="0,0,0,5"/>
                                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0,0,0,5" Background="#1A1A1A">
                                    <ItemsControl x:Name="AllowedSitesList">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="#2D3436" CornerRadius="3" Padding="6,3" Margin="2">
                                                    <DockPanel>
                                                        <Button DockPanel.Dock="Right" Content="✕" Click="RemoveSite_Click" 
                                                                Background="Transparent" BorderThickness="0" Foreground="#FF7675" 
                                                                Padding="5,0" Margin="4,0,-4,0" Cursor="Hand" VerticalAlignment="Center" FontSize="10">
                                                            <Button.Template>
                                                                <ControlTemplate TargetType="Button">
                                                                    <Border Background="Transparent">
                                                                        <ContentPresenter/>
                                                                    </Border>
                                                                </ControlTemplate>
                                                            </Button.Template>
                                                        </Button>
                                                        <TextBlock Text="{Binding}" Foreground="#CCC" FontSize="11" VerticalAlignment="Center"/>
                                                    </DockPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                                <DockPanel Grid.Row="2">
                                    <Button Content="+" Width="24" DockPanel.Dock="Right" Style="{StaticResource ModernButton}" Padding="0" Click="AddSite_Click"/>
                                    <TextBox x:Name="NewSiteInput" Margin="0,0,3,0" KeyDown="NewSiteInput_KeyDown" VerticalContentAlignment="Center" Height="24" Padding="4,0" FontSize="11"/>
                                </DockPanel>
                            </Grid>

                            <!-- Keywords -->
                            <Grid Grid.Column="2" Margin="5,0,0,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <TextBlock Text="TITLE KEYWORDS" Foreground="#888" FontSize="10" FontWeight="Bold" Margin="0,0,0,5"/>
                                 <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0,0,0,5" Background="#1A1A1A">
                                    <ItemsControl x:Name="AllowedKeywordsList">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="#2D3436" CornerRadius="3" Padding="6,3" Margin="2">
                                                    <DockPanel>
                                                        <Button DockPanel.Dock="Right" Content="✕" Click="RemoveKeyword_Click" 
                                                                Background="Transparent" BorderThickness="0" Foreground="#FF7675" 
                                                                Padding="5,0" Margin="4,0,-4,0" Cursor="Hand" VerticalAlignment="Center" FontSize="10">
                                                            <Button.Template>
                                                                <ControlTemplate TargetType="Button">
                                                                    <Border Background="Transparent">
                                                                        <ContentPresenter/>
                                                                    </Border>
                                                                </ControlTemplate>
                                                            </Button.Template>
                                                        </Button>
                                                        <TextBlock Text="{Binding}" Foreground="#CCC" FontSize="11" VerticalAlignment="Center"/>
                                                    </DockPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                                <DockPanel Grid.Row="2">
                                    <Button Content="+" Width="24" DockPanel.Dock="Right" Style="{StaticResource ModernButton}" Padding="0" Click="AddKeyword_Click"/>
                                    <TextBox x:Name="NewKeywordInput" Margin="0,0,3,0" KeyDown="NewKeywordInput_KeyDown" VerticalContentAlignment="Center" Height="24" Padding="4,0" FontSize="11"/>
                                </DockPanel>
                            </Grid>
                        </Grid>
                    </Grid>

                    <Button x:Name="StartSessionBtn" Grid.Row="4" 
                            Content="START FOCUS SESSION" 
                            Style="{StaticResource PrimaryButton}"
                            Height="40" FontSize="14"
                            Click="StartSessionBtn_Click" IsEnabled="False"/>
                </Grid>

                <!-- Dashboard View -->
                <Grid x:Name="DashboardView" Visibility="Collapsed">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/> <!-- Header & Button -->
                        <RowDefinition Height="Auto"/> <!-- Goal -->
                        <RowDefinition Height="Auto"/> <!-- Timer -->
                        <RowDefinition Height="*"/>    <!-- Log -->
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0" Margin="0,0,0,20">
                         <StackPanel HorizontalAlignment="Left" VerticalAlignment="Center">
                            <TextBlock Text="In Session" FontSize="16" FontWeight="Bold" Foreground="#444"/>
                        </StackPanel>
                        <Button HorizontalAlignment="Right" Content="Stop Session" Style="{StaticResource ModernButton}" Background="#D63031" Click="EndSessionBtn_Click"/>
                    </Grid>

                    <StackPanel Grid.Row="1" Margin="0,5,0,30">
                        <TextBlock Text="CURRENT GOAL" FontSize="10" Foreground="#888" Margin="0,0,0,4"/>
                        <TextBlock x:Name="CurrentGoalText" Text="..." FontSize="22" FontWeight="Light" TextWrapping="Wrap" Foreground="White"/>
                    </StackPanel>

                     <!-- Timer -->
                     <Viewbox Grid.Row="2" MaxHeight="100" HorizontalAlignment="Center" Margin="0,0,0,30">
                        <TextBlock x:Name="TimerText" Text="00:00:00" FontFamily="Consolas" Foreground="#00CEC9" FontWeight="Bold"/>
                    </Viewbox>

                    <!-- Activity Log -->
                    <Grid Grid.Row="3">
                        <Grid.RowDefinitions>
                             <RowDefinition Height="Auto"/>
                             <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="ACTIVITY LOG" FontSize="10" Foreground="#888" Margin="0,0,0,6"/>
                        <Border Grid.Row="1" Background="#000" CornerRadius="6" Padding="10" BorderBrush="#333" BorderThickness="1">
                            <TextBox x:Name="LogOutput" 
                                     Background="Transparent" Foreground="#00FF00" FontFamily="Consolas" BorderThickness="0" FontSize="12"
                                     IsReadOnly="True" VerticalScrollBarVisibility="Auto" TextWrapping="Wrap" Padding="0"/>
                        </Border>
                    </Grid>
                </Grid>
                
                <!-- Loading Overlay -->
                <Grid x:Name="LoadingOverlay" Visibility="Collapsed" Background="#E0121212">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                        <TextBlock Text="Thinking..." Foreground="White" FontSize="24" FontWeight="Light" HorizontalAlignment="Center"/>
                        <TextBlock Text="crafting your path to focus" Foreground="#888" FontSize="13" HorizontalAlignment="Center" Margin="0,8,0,0"/>
                    </StackPanel>
                </Grid>
            </Grid>

            <!-- Status Bar -->
            <Border Grid.Row="2" Background="#1A1A1A" BorderBrush="#333" BorderThickness="0,1,0,0" CornerRadius="0,0,8,8">
                <Grid Margin="10,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Ready" Foreground="#666" FontSize="10" VerticalAlignment="Center"/>
                    <TextBlock Text="v0.5.0" Grid.Column="1" Foreground="#444" FontSize="10" VerticalAlignment="Center"/>
                </Grid>
            </Border>

            <!-- Settings Overlay -->
            <Grid x:Name="SettingsOverlay" Grid.RowSpan="3" Visibility="Collapsed" Background="#CC000000">
                <Border Background="#252526" BorderBrush="#444" BorderThickness="1" CornerRadius="8" Width="320" VerticalAlignment="Center" HorizontalAlignment="Center" Padding="20">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="20" ShadowDepth="5" Opacity="0.6"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="Advanced Settings" Foreground="White" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,15" HorizontalAlignment="Center"/>

                        <!-- Notification Interval -->
                        <TextBlock Text="Notification Frequency (seconds)" Foreground="#AAA" FontSize="11" Margin="0,0,0,5"/>
                        <TextBox x:Name="NotificationIntervalInput" Text="30" Margin="0,0,0,15"/>

                        <!-- Phase 2 Threshold -->
                        <TextBlock Text="Escalation Threshold (notifications)" Foreground="#AAA" FontSize="11" Margin="0,0,0,5"/>
                        <TextBox x:Name="Phase2ThresholdInput" Text="3" Margin="0,0,0,15"/>

                        <!-- Phase 2 Interval -->
                        <TextBlock Text="Phase 2 (Wiggle) Interval (seconds)" Foreground="#AAA" FontSize="11" Margin="0,0,0,5"/>
                        <TextBox x:Name="Phase2IntervalInput" Text="10" Margin="0,0,0,15"/>

                        <!-- Phase 3 Threshold -->
                        <TextBlock Text="Max Wiggles (Phase 3 Threshold)" Foreground="#AAA" FontSize="11" Margin="0,0,0,5"/>
                        <TextBox x:Name="Phase3ThresholdInput" Text="5" Margin="0,0,0,15"/>

                        <!-- Phase 3 Delay -->
                        <TextBlock Text="Phase 3 Penalty Delay (seconds)" Foreground="#AAA" FontSize="11" Margin="0,0,0,5"/>
                        <TextBox x:Name="Phase3DelayInput" Text="10" Margin="0,0,0,20"/>

                        <Button Content="Save &amp; Close" Style="{StaticResource PrimaryButton}" Click="SettingsCloseBtn_Click"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
    </Border>
</Window>
